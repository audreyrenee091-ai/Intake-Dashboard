<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Patel Firm Intake Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDm_IS6YcY-XMjzMXVWTss6pf5XtLYKF5Q",
            authDomain: "the-patel-firm-intake-system.firebaseapp.com",
            projectId: "the-patel-firm-intake-system",
            storageBucket: "the-patel-firm-intake-system.firebasestorage.app",
            messagingSenderId: "354681856942",
            appId: "1:354681856942:web:116397e58734f754f81e3f",
            measurementId: "G-206YES2DV0"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { AlertCircle, CheckCircle, Clock, FileText, Send, Plus, X, ChevronLeft, ChevronRight, Home } = window.lucideReact || {};

        // Import Lucide icons
        const loadLucide = () => {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/lucide@latest/dist/umd/lucide.js';
                script.onload = () => {
                    lucide.createIcons();
                    resolve();
                };
                document.head.appendChild(script);
            });
        };

        function PNCManager() {
            const [clients, setClients] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [loading, setLoading] = useState(true);
            const [currentUser, setCurrentUser] = useState('');
            const [notification, setNotification] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const [viewMode, setViewMode] = useState('dashboard');
            const itemsPerPage = 15;

            const [formData, setFormData] = useState({
                clientName: '', dob: '', ssn: '', healthInsurance: '', dlNumber: '', seatPosition: '',
                phone: '', mailingAddress: '', email: '', emergencyContact: '',
                doi: '', incidentType: '', accidentDetails: '', accidentType: '', policeReport: '',
                policeReportDept: '', policeReportNumber: '', cityCountyState: '',
                injuries: '', hospitalEMS: '',
                adverseName: '', adverseDL: '', adversePlates: '', adverseAutoIns: '', adverseClaimNumber: '',
                clientInsCompany: '', clientPolicyNumber: '',
                clientVehicle: '', caseManagementLink: '',
                intakeUsername: '', // Username in the form
                status: 'pending' // Default status
            });

            const [selectedClient, setSelectedClient] = useState(null);
            const [showClientModal, setShowClientModal] = useState(false);
            const [isEditingClient, setIsEditingClient] = useState(false);
            const [editedClient, setEditedClient] = useState(null);
            const [statusFilter, setStatusFilter] = useState('all');

            useEffect(() => {
                loadClients();
                loadCurrentUser();
            }, []);

            const loadClients = async () => {
                try {
                    // Real-time listener for Firebase
                    const unsubscribe = db.collection('clients').orderBy('intakeDate', 'desc').onSnapshot((snapshot) => {
                        const clientsData = [];
                        snapshot.forEach((doc) => {
                            clientsData.push({ id: doc.id, ...doc.data() });
                        });
                        setClients(clientsData);
                        setLoading(false);
                    }, (error) => {
                        console.error('Error loading clients:', error);
                        setLoading(false);
                    });
                    
                    // Cleanup listener on unmount
                    return () => unsubscribe();
                } catch (error) {
                    console.error('Error setting up listener:', error);
                    setLoading(false);
                }
            };

            const loadCurrentUser = () => {
                const savedUser = localStorage.getItem('pnc-current-user');
                if (savedUser) {
                    setCurrentUser(savedUser);
                }
            };

            const saveClients = async (updatedClients) => {
                // This function is no longer needed as we save individually
                // Kept for compatibility
                setClients(updatedClients);
            };

            const saveClient = async (client) => {
                try {
                    if (client.id) {
                        // Update existing client
                        await db.collection('clients').doc(client.id).set(client);
                    } else {
                        // Add new client
                        const docRef = await db.collection('clients').add(client);
                        return docRef.id;
                    }
                } catch (error) {
                    console.error('Failed to save client:', error);
                    showNotification('Failed to save changes', 'error');
                    throw error;
                }
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 5000);
            };

            const sendEmailNotification = async (client, action) => {
                console.log('Email notification sent:', client.clientName);
                showNotification(`Email notification sent for ${client.clientName}`, 'success');
            };

            const sendToIntake = (client) => {
                // Format email content
                const subject = `New PNC Intake: ${client.clientName}`;
                const body = `
NEW POTENTIAL CLIENT INTAKE

IDENTIFICATION
Client Name: ${client.clientName || 'N/A'}
Date of Birth: ${client.dob || 'N/A'}
SSN: ${client.ssn || 'N/A'}
Health Insurance: ${client.healthInsurance || 'N/A'}
Driver's License #: ${client.dlNumber || 'N/A'}
Seat Position: ${client.seatPosition || 'N/A'}

CONTACT INFORMATION
Phone: ${client.phone || 'N/A'}
Email: ${client.email || 'N/A'}
Mailing Address: ${client.mailingAddress || 'N/A'}
Emergency Contact: ${client.emergencyContact || 'N/A'}

INCIDENT FACTS
Date of Incident (DOI): ${client.doi || 'N/A'}
Incident Type: ${client.incidentType || 'N/A'}
Type of Accident: ${client.accidentType || 'N/A'}
City/County/State: ${client.cityCountyState || 'N/A'}
Accident Details: ${client.accidentDetails || 'N/A'}
Police Report: ${client.policeReport || 'N/A'}
Police Department: ${client.policeReportDept || 'N/A'}
Police Report #: ${client.policeReportNumber || 'N/A'}

MEDICAL INFORMATION
Injuries: ${client.injuries || 'N/A'}
Hospital/EMS: ${client.hospitalEMS || 'N/A'}

ADVERSE PARTY INSURANCE INFO
Adverse Party Name: ${client.adverseName || 'N/A'}
Adverse DL Number: ${client.adverseDL || 'N/A'}
License Plates: ${client.adversePlates || 'N/A'}
Adverse Auto Insurance: ${client.adverseAutoIns || 'N/A'}
Claim Number: ${client.adverseClaimNumber || 'N/A'}

CLIENT INSURANCE INFO
Insurance Company: ${client.clientInsCompany || 'N/A'}
Policy #: ${client.clientPolicyNumber || 'N/A'}

CLIENT VEHICLE INFO
Vehicle: ${client.clientVehicle || 'N/A'}

CASE MANAGEMENT
Case Management Link: ${client.caseManagementLink || 'N/A'}

STATUS & TRACKING
Status: ${client.status || 'N/A'}
Added By: ${client.addedBy || 'N/A'}
Intake Date: ${client.intakeDate ? new Date(client.intakeDate).toLocaleString() : 'N/A'}
                `.trim();

                // Create mailto link
                const mailtoLink = `mailto:intake@thepatelfirm.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Open email client
                window.location.href = mailtoLink;
                
                showNotification('Opening email client...', 'success');
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.intakeUsername) {
                    showNotification('Please enter your username in the form', 'error');
                    return;
                }

                const newClient = {
                    ...formData,
                    intakeDate: new Date().toISOString(),
                    dateAdded: new Date().toISOString(),
                    addedBy: formData.intakeUsername,
                    history: [{ action: 'Created', user: formData.intakeUsername, timestamp: new Date().toISOString() }]
                };

                try {
                    await saveClient(newClient);
                    sendEmailNotification(newClient, 'created');
                    
                    // Reset form but keep username
                    const savedUsername = formData.intakeUsername;
                    setFormData({
                        clientName: '', dob: '', ssn: '', healthInsurance: '', dlNumber: '', seatPosition: '',
                        phone: '', mailingAddress: '', email: '', emergencyContact: '',
                        doi: '', incidentType: '', accidentDetails: '', accidentType: '', policeReport: '',
                        policeReportDept: '', policeReportNumber: '', cityCountyState: '',
                        injuries: '', hospitalEMS: '',
                        adverseName: '', adverseDL: '', adversePlates: '', adverseAutoIns: '', adverseClaimNumber: '',
                        clientInsCompany: '', clientPolicyNumber: '',
                        clientVehicle: '', caseManagementLink: '',
                        intakeUsername: savedUsername,
                        status: 'pending'
                    });
                    setShowForm(false);
                    setViewMode('dashboard');
                    showNotification('Client intake submitted successfully!', 'success');
                } catch (error) {
                    console.error('Error submitting intake:', error);
                    showNotification('Failed to submit intake', 'error');
                }
            };

            const updateClientStatus = async (clientId, newStatus) => {
                try {
                    const clientRef = db.collection('clients').doc(clientId);
                    const clientDoc = await clientRef.get();
                    
                    if (clientDoc.exists) {
                        const clientData = clientDoc.data();
                        const historyEntry = {
                            action: `Status changed to ${newStatus}`,
                            user: clientData.addedBy || 'System',
                            timestamp: new Date().toISOString()
                        };
                        
                        const updatedClient = {
                            ...clientData,
                            status: newStatus,
                            lastUpdatedBy: clientData.addedBy || 'System',
                            lastUpdated: new Date().toISOString(),
                            history: [...(clientData.history || []), historyEntry]
                        };
                        
                        await clientRef.set(updatedClient);
                        
                        // Update selectedClient if modal is open
                        if (selectedClient && selectedClient.id === clientId) {
                            setSelectedClient({id: clientId, ...updatedClient});
                        }
                        
                        showNotification(`Status updated to ${newStatus}`, 'success');
                    }
                } catch (error) {
                    console.error('Error updating status:', error);
                    showNotification('Failed to update status', 'error');
                }
            };

            const openClientDetails = (client) => {
                setSelectedClient(client);
                setEditedClient({...client});
                setIsEditingClient(false);
                setShowClientModal(true);
            };

            const closeClientModal = () => {
                setShowClientModal(false);
                setSelectedClient(null);
                setIsEditingClient(false);
                setEditedClient(null);
            };

            const startEditing = () => {
                setIsEditingClient(true);
            };

            const cancelEditing = () => {
                setEditedClient({...selectedClient});
                setIsEditingClient(false);
            };

            const saveClientEdits = async () => {
                try {
                    await saveClient(editedClient);
                    setSelectedClient(editedClient);
                    setIsEditingClient(false);
                    showNotification('Client updated successfully!', 'success');
                } catch (error) {
                    console.error('Error saving client:', error);
                    showNotification('Failed to save changes', 'error');
                }
            };

            const deleteClient = async (clientId) => {
                if (!confirm('Are you sure you want to delete this client? This action cannot be undone.')) {
                    return;
                }

                try {
                    await db.collection('clients').doc(clientId).delete();
                    closeClientModal();
                    showNotification('Client deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting client:', error);
                    showNotification('Failed to delete client', 'error');
                }
            };

            const handleUserNameChange = (e) => {
                const username = e.target.value;
                setCurrentUser(username);
                localStorage.setItem('pnc-current-user', username);
            };

            const exportToExcel = () => {
                if (clients.length === 0) {
                    showNotification('No data to export', 'error');
                    return;
                }

                // Create CSV content
                const headers = [
                    'Client Name', 'DOB', 'Phone', 'Email', 'DOI', 'Incident Type', 
                    'Accident Type', 'City/County/State', 'Status', 'Added By', 
                    'Intake Date', 'Injuries', 'Hospital/EMS', 'SSN', 'Health Insurance',
                    'DL Number', 'Seat Position', 'Mailing Address', 'Emergency Contact',
                    'Accident Details', 'Police Report', 'Police Dept', 'Police Report Number',
                    'Adverse Name', 'Adverse DL', 'License Plates', 'Adverse Auto Insurance',
                    'Adverse Claim Number', 'Client Insurance Company', 'Client Policy Number',
                    'Client Vehicle', 'Case Management Link', 'Last Updated By', 'Last Updated'
                ];

                const csvRows = [headers.join(',')];

                clients.forEach(client => {
                    const row = [
                        client.clientName || '',
                        client.dob || '',
                        client.phone || '',
                        client.email || '',
                        client.doi || '',
                        client.incidentType || '',
                        client.accidentType || '',
                        client.cityCountyState || '',
                        client.status || '',
                        client.addedBy || '',
                        client.intakeDate ? new Date(client.intakeDate).toLocaleString() : '',
                        client.injuries || '',
                        client.hospitalEMS || '',
                        client.ssn || '',
                        client.healthInsurance || '',
                        client.dlNumber || '',
                        client.seatPosition || '',
                        client.mailingAddress || '',
                        client.emergencyContact || '',
                        client.accidentDetails || '',
                        client.policeReport || '',
                        client.policeReportDept || '',
                        client.policeReportNumber || '',
                        client.adverseName || '',
                        client.adverseDL || '',
                        client.adversePlates || '',
                        client.adverseAutoIns || '',
                        client.adverseClaimNumber || '',
                        client.clientInsCompany || '',
                        client.clientPolicyNumber || '',
                        client.clientVehicle || '',
                        client.caseManagementLink || '',
                        client.lastUpdatedBy || '',
                        client.lastUpdated ? new Date(client.lastUpdated).toLocaleString() : ''
                    ].map(field => `"${String(field).replace(/"/g, '""')}"`);
                    
                    csvRows.push(row.join(','));
                });

                const csvContent = csvRows.join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `PNC_Data_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Data exported successfully!', 'success');
            };

            const getStatusBadge = (status) => {
                const statusConfig = {
                    pending: { color: 'bg-yellow-100 text-yellow-800', label: 'Pending' },
                    declined: { color: 'bg-red-100 text-red-800', label: 'Declined' },
                    'approved-pending-contract': { color: 'bg-blue-100 text-blue-800', label: 'Approved - Pending Contract' },
                    'approved-contract-signed': { color: 'bg-green-100 text-green-800', label: 'Approved - Contract Signed' },
                    'further-eval': { color: 'bg-purple-100 text-purple-800', label: 'Further Eval' }
                };

                const config = statusConfig[status] || statusConfig.pending;

                return (
                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${config.color}`}>
                        {config.label}
                    </span>
                );
            };

            // Filtering and Pagination
            const filteredClients = statusFilter === 'all' ? clients : clients.filter(c => c.status === statusFilter);
            const totalPages = Math.ceil(filteredClients.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentClients = filteredClients.slice(startIndex, endIndex);

            const goToPage = (page) => {
                setCurrentPage(Math.max(1, Math.min(page, totalPages)));
            };

            const filterByStatus = (status) => {
                setStatusFilter(status);
                setCurrentPage(1);
                setViewMode('list');
            };

            const stats = {
                total: clients.length,
                declined: clients.filter(c => c.status === 'declined').length,
                approvedPending: clients.filter(c => c.status === 'approved-pending-contract').length,
                approvedSigned: clients.filter(c => c.status === 'approved-contract-signed').length,
                furtherEval: clients.filter(c => c.status === 'further-eval').length,
                pending: clients.filter(c => c.status === 'pending').length
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-4xl mb-4">‚è≥</div>
                            <p className="text-gray-600">Loading...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {notification && (
                        <div className={`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
                            notification.type === 'error' ? 'bg-red-500' : 'bg-green-500'
                        } text-white`}>
                            {notification.message}
                        </div>
                    )}

                    <div className="bg-white shadow">
                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <div className="flex justify-between items-center flex-wrap gap-4">
                                <div className="flex items-center gap-4">
                                    <div className="bg-gray-900 text-white px-4 py-3 rounded-lg font-bold text-2xl">TPF</div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-900">The Patel Firm</h1>
                                        <p className="text-gray-600 mt-1">Intake Dashboard</p>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setViewMode('dashboard')}
                                        className={`px-4 py-2 rounded-lg transition ${
                                            viewMode === 'dashboard' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}
                                    >
                                        üìä Dashboard
                                    </button>
                                    <button
                                        onClick={exportToExcel}
                                        className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition"
                                        title="Export all data to Excel"
                                    >
                                        üì• Export
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowForm(!showForm);
                                            if (!showForm) setViewMode('list');
                                        }}
                                        className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition"
                                    >
                                        ‚ûï New Intake
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-8">
                        {viewMode === 'dashboard' && !showForm && (
                            <div>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
                                    <div onClick={() => filterByStatus('all')} className="bg-white rounded-lg shadow p-6 border-l-4 border-gray-400 cursor-pointer hover:bg-gray-50 transition">
                                        <div className="text-3xl font-bold text-gray-900">{stats.total}</div>
                                        <div className="text-sm text-gray-600 mt-1">Total PNCs</div>
                                        <div className="text-xs text-blue-600 mt-2">Click to view all</div>
                                    </div>
                                    <div onClick={() => filterByStatus('pending')} className="bg-white rounded-lg shadow p-6 border-l-4 border-yellow-400 cursor-pointer hover:bg-gray-50 transition">
                                        <div className="text-3xl font-bold text-yellow-600">{stats.pending}</div>
                                        <div className="text-sm text-gray-600 mt-1">Pending</div>
                                        <div className="text-xs text-blue-600 mt-2">Click to filter</div>
                                    </div>
                                    <div onClick={() => filterByStatus('declined')} className="bg-white rounded-lg shadow p-6 border-l-4 border-red-400 cursor-pointer hover:bg-gray-50 transition">
                                        <div className="text-3xl font-bold text-red-600">{stats.declined}</div>
                                        <div className="text-sm text-gray-600 mt-1">Declined</div>
                                        <div className="text-xs text-blue-600 mt-2">Click to filter</div>
                                    </div>
                                    <div onClick={() => filterByStatus('approved-pending-contract')} className="bg-white rounded-lg shadow p-6 border-l-4 border-blue-400 cursor-pointer hover:bg-gray-50 transition">
                                        <div className="text-3xl font-bold text-blue-600">{stats.approvedPending}</div>
                                        <div className="text-sm text-gray-600 mt-1">Approved - Pending Contract</div>
                                        <div className="text-xs text-blue-600 mt-2">Click to filter</div>
                                    </div>
                                    <div onClick={() => filterByStatus('approved-contract-signed')} className="bg-white rounded-lg shadow p-6 border-l-4 border-green-400 cursor-pointer hover:bg-gray-50 transition">
                                        <div className="text-3xl font-bold text-green-600">{stats.approvedSigned}</div>
                                        <div className="text-sm text-gray-600 mt-1">Approved - Contract Signed</div>
                                        <div className="text-xs text-blue-600 mt-2">Click to filter</div>
                                    </div>
                                    <div onClick={() => filterByStatus('further-eval')} className="bg-white rounded-lg shadow p-6 border-l-4 border-purple-400 cursor-pointer hover:bg-gray-50 transition">
                                        <div className="text-3xl font-bold text-purple-600">{stats.furtherEval}</div>
                                        <div className="text-sm text-gray-600 mt-1">Further Eval</div>
                                        <div className="text-xs text-blue-600 mt-2">Click to filter</div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-xl font-bold text-gray-900 mb-4">Recent Activity</h2>
                                    {clients.length === 0 ? (
                                        <div className="text-center py-12">
                                            <div className="text-6xl mb-4">üìã</div>
                                            <h3 className="text-xl font-semibold text-gray-900 mb-2">No clients yet</h3>
                                            <p className="text-gray-600">Click "New Intake" to add your first client</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {clients.slice(0, 10).map((client) => (
                                                <div key={client.id} className="flex items-start justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition cursor-pointer border-2 border-transparent hover:border-blue-300" onClick={() => openClientDetails(client)}>
                                                    <div className="flex-1">
                                                        <div className="font-medium text-gray-900 text-lg flex items-center gap-2">
                                                            {client.clientName}
                                                            <span className="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded">Click to edit</span>
                                                        </div>
                                                        <div className="text-sm text-gray-600 mt-1 grid grid-cols-2 gap-2">
                                                            <div><span className="font-medium">Date Created:</span> {new Date(client.intakeDate).toLocaleDateString()}</div>
                                                            <div><span className="font-medium">Username:</span> {client.addedBy}</div>
                                                            <div><span className="font-medium">Accident Type:</span> {client.accidentType || 'Not specified'}</div>
                                                            <div><span className="font-medium">DOI:</span> {client.doi || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div className="ml-4 flex flex-col gap-2 items-end">
                                                        <div onClick={(e) => {
                                                            e.stopPropagation();
                                                            openClientDetails(client);
                                                        }}>
                                                            {getStatusBadge(client.status)}
                                                        </div>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                sendToIntake(client);
                                                            }}
                                                            className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition"
                                                        >
                                                            üìß Send to Intake
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    {clients.length > 10 && (
                                        <button
                                            onClick={() => setViewMode('list')}
                                            className="mt-4 text-blue-600 hover:text-blue-700 font-medium"
                                        >
                                            View all {clients.length} clients ‚Üí
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}

                        {showForm && (
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">New Client Intake Form</h2>
                                    <button onClick={() => setShowForm(false)} className="text-gray-500 hover:text-gray-700 text-2xl">
                                        ‚úï
                                    </button>
                                </div>
                                
                                <form onSubmit={handleSubmit} className="space-y-6">
                                    <div className="border-b pb-6 bg-blue-50 p-4 rounded-lg">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Your Username (for tracking) *</label>
                                                <input 
                                                    type="text" 
                                                    required 
                                                    value={formData.intakeUsername} 
                                                    onChange={(e) => setFormData({ ...formData, intakeUsername: e.target.value })} 
                                                    placeholder="Enter your name"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-3">Initial Status</label>
                                                <div className="space-y-2">
                                                    <label className="flex items-center">
                                                        <input 
                                                            type="radio" 
                                                            name="status" 
                                                            value="pending" 
                                                            checked={formData.status === 'pending'}
                                                            onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                            className="mr-2" 
                                                        />
                                                        <span className="text-sm">‚è≥ Pending</span>
                                                    </label>
                                                    <label className="flex items-center">
                                                        <input 
                                                            type="radio" 
                                                            name="status" 
                                                            value="declined" 
                                                            checked={formData.status === 'declined'}
                                                            onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                            className="mr-2" 
                                                        />
                                                        <span className="text-sm">‚ùå Declined</span>
                                                    </label>
                                                    <label className="flex items-center">
                                                        <input 
                                                            type="radio" 
                                                            name="status" 
                                                            value="approved-pending-contract" 
                                                            checked={formData.status === 'approved-pending-contract'}
                                                            onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                            className="mr-2" 
                                                        />
                                                        <span className="text-sm">üìÑ Approved - Pending Contract</span>
                                                    </label>
                                                    <label className="flex items-center">
                                                        <input 
                                                            type="radio" 
                                                            name="status" 
                                                            value="approved-contract-signed" 
                                                            checked={formData.status === 'approved-contract-signed'}
                                                            onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                            className="mr-2" 
                                                        />
                                                        <span className="text-sm">‚úÖ Approved - Contract Signed</span>
                                                    </label>
                                                    <label className="flex items-center">
                                                        <input 
                                                            type="radio" 
                                                            name="status" 
                                                            value="further-eval" 
                                                            checked={formData.status === 'further-eval'}
                                                            onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                            className="mr-2" 
                                                        />
                                                        <span className="text-sm">üîç Further Eval</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Identification</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            <div className="md:col-span-2">
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Client Name *</label>
                                                <input type="text" required value={formData.clientName} onChange={(e) => setFormData({ ...formData, clientName: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">DOB</label>
                                                <input type="date" value={formData.dob} onChange={(e) => setFormData({ ...formData, dob: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">SSN</label>
                                                <input type="text" value={formData.ssn} onChange={(e) => setFormData({ ...formData, ssn: e.target.value })} placeholder="###-##-####" className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Health Insurance</label>
                                                <input type="text" value={formData.healthInsurance} onChange={(e) => setFormData({ ...formData, healthInsurance: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Driver's License #</label>
                                                <input type="text" value={formData.dlNumber} onChange={(e) => setFormData({ ...formData, dlNumber: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Seat Position</label>
                                                <input type="text" value={formData.seatPosition} onChange={(e) => setFormData({ ...formData, seatPosition: e.target.value })} placeholder="Driver, Passenger, etc." className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Contact Information</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Phone # *</label>
                                                <input type="tel" required value={formData.phone} onChange={(e) => setFormData({ ...formData, phone: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                                <input type="email" value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Mailing Address</label>
                                                <input type="text" value={formData.mailingAddress} onChange={(e) => setFormData({ ...formData, mailingAddress: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Emergency Contact</label>
                                                <input type="text" value={formData.emergencyContact} onChange={(e) => setFormData({ ...formData, emergencyContact: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Incident Facts</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">DOI (Date of Incident) *</label>
                                                <input type="date" required value={formData.doi} onChange={(e) => setFormData({ ...formData, doi: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Incident Type</label>
                                                <input type="text" value={formData.incidentType} onChange={(e) => setFormData({ ...formData, incidentType: e.target.value })} placeholder="Auto, Slip & Fall, etc." className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Type of Accident</label>
                                                <select value={formData.accidentType} onChange={(e) => setFormData({ ...formData, accidentType: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                                    <option value="">Select type</option>
                                                    <option value="Head-on">Head-on</option>
                                                    <option value="T-bone">T-bone</option>
                                                    <option value="Side swipe">Side swipe</option>
                                                    <option value="Rear-end">Rear-end</option>
                                                    <option value="Hit/Run">Hit/Run</option>
                                                    <option value="Pedestrian">Pedestrian</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">City/County/State</label>
                                                <input type="text" value={formData.cityCountyState} onChange={(e) => setFormData({ ...formData, cityCountyState: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div className="md:col-span-2">
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Accident Details</label>
                                                <textarea value={formData.accidentDetails} onChange={(e) => setFormData({ ...formData, accidentDetails: e.target.value })} rows="3" className="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Police Report?</label>
                                                <select value={formData.policeReport} onChange={(e) => setFormData({ ...formData, policeReport: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                                    <option value="">Select</option>
                                                    <option value="Yes">Yes</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Police Dept</label>
                                                <input type="text" value={formData.policeReportDept} onChange={(e) => setFormData({ ...formData, policeReportDept: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Police Report #</label>
                                                <input type="text" value={formData.policeReportNumber} onChange={(e) => setFormData({ ...formData, policeReportNumber: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Medical Information</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Injuries</label>
                                                <textarea value={formData.injuries} onChange={(e) => setFormData({ ...formData, injuries: e.target.value })} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Hospital/EMS</label>
                                                <input type="text" value={formData.hospitalEMS} onChange={(e) => setFormData({ ...formData, hospitalEMS: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Adverse Party Insurance Info</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Adverse Party Name/Info</label>
                                                <input type="text" value={formData.adverseName} onChange={(e) => setFormData({ ...formData, adverseName: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Adverse DL Number</label>
                                                <input type="text" value={formData.adverseDL} onChange={(e) => setFormData({ ...formData, adverseDL: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">License Plates</label>
                                                <input type="text" value={formData.adversePlates} onChange={(e) => setFormData({ ...formData, adversePlates: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Adverse Auto Insurance</label>
                                                <input type="text" value={formData.adverseAutoIns} onChange={(e) => setFormData({ ...formData, adverseAutoIns: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Claim #</label>
                                                <input type="text" value={formData.adverseClaimNumber} onChange={(e) => setFormData({ ...formData, adverseClaimNumber: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Client Insurance Info</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Insurance Company</label>
                                                <input type="text" value={formData.clientInsCompany} onChange={(e) => setFormData({ ...formData, clientInsCompany: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Policy #</label>
                                                <input type="text" value={formData.clientPolicyNumber} onChange={(e) => setFormData({ ...formData, clientPolicyNumber: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Client Vehicle Info</h3>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Year/Make/Model/Color</label>
                                            <input type="text" value={formData.clientVehicle} onChange={(e) => setFormData({ ...formData, clientVehicle: e.target.value })} placeholder="e.g., 2020 Toyota Camry, Silver" className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                        </div>
                                    </div>

                                    {/* Quick Links Section */}
                                    <div className="border-b pb-6 bg-yellow-50 p-4 rounded-lg">
                                        <h3 className="text-lg font-semibold mb-3 text-gray-900">Quick Actions</h3>
                                        <div className="flex gap-3">
                                            <a 
                                                href="https://app.vinesign.com/Jobs/Create" 
                                                target="_blank" 
                                                rel="noopener noreferrer"
                                                className="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-medium text-center transition flex items-center justify-center gap-2"
                                            >
                                                ‚úçÔ∏è Send Contract via Vinesign
                                            </a>
                                        </div>
                                        <p className="text-xs text-gray-600 mt-2">Click to open Vinesign in a new tab to send client contracts</p>
                                    </div>

                                    <div>
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Case Management</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Case Management System Link</label>
                                                <input type="url" value={formData.caseManagementLink} onChange={(e) => setFormData({ ...formData, caseManagementLink: e.target.value })} placeholder="https://..." className="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Create New Project</label>
                                                <a 
                                                    href="https://thepatelfirm.filevineapp.com/#/project/create" 
                                                    target="_blank" 
                                                    rel="noopener noreferrer"
                                                    className="block w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium text-center transition"
                                                >
                                                    üìÅ Open Filevine
                                                </a>
                                                <p className="text-xs text-gray-600 mt-1">Click to create a new project in Filevine</p>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" className="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium text-lg transition">
                                        Submit Intake Form
                                    </button>
                                </form>
                            </div>
                        )}

                        {viewMode === 'list' && !showForm && (
                            <div>
                                {clients.length === 0 ? (
                                    <div className="bg-white rounded-lg shadow p-12 text-center">
                                        <div className="text-6xl mb-4">üìã</div>
                                        <h3 className="text-xl font-semibold text-gray-900 mb-2">No clients yet</h3>
                                        <p className="text-gray-600">Click "New Intake" to add your first client</p>
                                    </div>
                                ) : (
                                    <>
                                        <div className="bg-white rounded-lg shadow overflow-hidden">
                                            <div className="overflow-x-auto">
                                                <table className="min-w-full divide-y divide-gray-200">
                                                    <thead className="bg-gray-50">
                                                        <tr>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Client</th>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">DOI</th>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contact</th>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Incident</th>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Added By</th>
                                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="bg-white divide-y divide-gray-200">
                                                        {currentClients.map((client) => (
                                                            <tr key={client.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => openClientDetails(client)}>
                                                                <td className="px-4 py-4">
                                                                    <div className="text-sm font-medium text-gray-900">{client.clientName}</div>
                                                                    <div className="text-xs text-gray-500">DOB: {client.dob || 'N/A'}</div>
                                                                    {client.caseManagementLink && (
                                                                        <a href={client.caseManagementLink} target="_blank" rel="noopener noreferrer" className="text-xs text-blue-600 hover:underline" onClick={(e) => e.stopPropagation()}>
                                                                            üìÑ Case Link
                                                                        </a>
                                                                    )}
                                                                </td>
                                                                <td className="px-4 py-4 text-sm text-gray-900">
                                                                    {client.doi || 'N/A'}
                                                                    <div className="text-xs text-gray-500">{client.incidentType}</div>
                                                                </td>
                                                                <td className="px-4 py-4">
                                                                    <div className="text-sm text-gray-900">{client.phone}</div>
                                                                    <div className="text-xs text-gray-500">{client.email || 'N/A'}</div>
                                                                </td>
                                                                <td className="px-4 py-4">
                                                                    <div className="text-sm text-gray-900">{client.accidentType || 'N/A'}</div>
                                                                    <div className="text-xs text-gray-500">{client.cityCountyState}</div>
                                                                </td>
                                                                <td className="px-4 py-4">
                                                                    {getStatusBadge(client.status)}
                                                                </td>
                                                                <td className="px-4 py-4">
                                                                    <div className="text-sm text-gray-900">{client.addedBy}</div>
                                                                    <div className="text-xs text-gray-500">{new Date(client.intakeDate).toLocaleDateString()}</div>
                                                                </td>
                                                                <td className="px-4 py-4">
                                                                    <select value={client.status} onChange={(e) => updateClientStatus(client.id, e.target.value)} className="text-xs border border-gray-300 rounded px-2 py-1 w-full mb-2">
                                                                        <option value="pending">Pending</option>
                                                                        <option value="declined">Declined</option>
                                                                        <option value="approved-pending-contract">Approved - Pending Contract</option>
                                                                        <option value="approved-contract-signed">Approved - Contract Signed</option>
                                                                        <option value="further-eval">Further Eval</option>
                                                                    </select>
                                                                    
                                                                    <button
                                                                        onClick={() => sendToIntake(client)}
                                                                        className="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs w-full mb-2 transition"
                                                                    >
                                                                        üìß Send to Intake
                                                                    </button>
                                                                    
                                                                    {client.history && client.history.length > 1 && (
                                                                        <details className="mt-2">
                                                                            <summary className="text-xs text-gray-500 cursor-pointer hover:text-gray-700">
                                                                                History ({client.history.length})
                                                                            </summary>
                                                                            <div className="mt-2 text-xs space-y-1 max-h-40 overflow-y-auto">
                                                                                {client.history.map((entry, idx) => (
                                                                                    <div key={idx} className="text-gray-600 bg-gray-50 p-2 rounded">
                                                                                        <div className="font-medium">{entry.action}</div>
                                                                                        <div className="text-gray-500">{entry.user} ‚Ä¢ {new Date(entry.timestamp).toLocaleString()}</div>
                                                                                    </div>
                                                                                ))}
                                                                            </div>
                                                                        </details>
                                                                    )}
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        {totalPages > 1 && (
                                            <div className="bg-white rounded-lg shadow mt-4 px-6 py-4 flex items-center justify-between">
                                                <div className="text-sm text-gray-700">
                                                    Showing <span className="font-medium">{startIndex + 1}</span> to <span className="font-medium">{Math.min(endIndex, filteredClients.length)}</span> of{' '}
                                                    <span className="font-medium">{filteredClients.length}</span> results
                                                    {statusFilter !== 'all' && <span className="ml-2 text-blue-600">(filtered by status)</span>}
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={() => goToPage(currentPage - 1)} disabled={currentPage === 1} className="px-3 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                                                        ‚óÄ
                                                    </button>
                                                    {[...Array(Math.min(totalPages, 10))].map((_, i) => {
                                                        const pageNum = i + 1;
                                                        if (totalPages <= 10 || pageNum <= 3 || pageNum >= totalPages - 2 || Math.abs(pageNum - currentPage) <= 1) {
                                                            return (
                                                                <button key={i} onClick={() => goToPage(pageNum)} className={`px-4 py-2 rounded-lg ${currentPage === pageNum ? 'bg-blue-600 text-white' : 'border border-gray-300 hover:bg-gray-50'}`}>
                                                                    {pageNum}
                                                                </button>
                                                            );
                                                        } else if (pageNum === 4 || pageNum === totalPages - 3) {
                                                            return <span key={i} className="px-2 py-2">...</span>;
                                                        }
                                                        return null;
                                                    })}
                                                    <button onClick={() => goToPage(currentPage + 1)} disabled={currentPage === totalPages} className="px-3 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                                                        ‚ñ∂
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Client Details Modal */}
                    {showClientModal && selectedClient && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={closeClientModal}>
                            <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                                    <h2 className="text-2xl font-bold text-gray-900">{isEditingClient ? 'Edit Client' : selectedClient.clientName}</h2>
                                    <div className="flex gap-2 items-center">
                                        {!isEditingClient ? (
                                            <>
                                                <button onClick={startEditing} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button onClick={() => deleteClient(selectedClient.id)} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                                                    üóëÔ∏è Delete
                                                </button>
                                            </>
                                        ) : (
                                            <>
                                                <button onClick={saveClientEdits} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">
                                                    ‚úì Save
                                                </button>
                                                <button onClick={cancelEditing} className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition">
                                                    ‚úï Cancel
                                                </button>
                                            </>
                                        )}
                                        <button onClick={closeClientModal} className="text-gray-500 hover:text-gray-700 text-2xl ml-2">
                                            ‚úï
                                        </button>
                                    </div>
                                </div>

                                <div className="p-6 space-y-6">
                                    {/* Status Update Section */}
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h3 className="text-lg font-semibold mb-3 text-gray-900">Update Status</h3>
                                        <div className="flex gap-2 flex-wrap">
                                            {['pending', 'declined', 'approved-pending-contract', 'approved-contract-signed', 'further-eval'].map((status) => (
                                                <button
                                                    key={status}
                                                    onClick={() => updateClientStatus(selectedClient.id, status)}
                                                    className={`px-4 py-2 rounded-lg font-medium transition ${
                                                        selectedClient.status === status
                                                            ? 'bg-blue-600 text-white'
                                                            : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'
                                                    }`}
                                                >
                                                    {status === 'pending' && '‚è≥ Pending'}
                                                    {status === 'declined' && '‚ùå Declined'}
                                                    {status === 'approved-pending-contract' && 'üìÑ Approved - Pending Contract'}
                                                    {status === 'approved-contract-signed' && '‚úÖ Approved - Contract Signed'}
                                                    {status === 'further-eval' && 'üîç Further Eval'}
                                                </button>
                                            ))}
                                        </div>
                                        <div className="mt-3 text-sm text-gray-600">
                                            Current Status: {getStatusBadge(selectedClient.status)}
                                        </div>
                                    </div>

                                    {/* Quick Actions */}
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => sendToIntake(selectedClient)}
                                            className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition"
                                        >
                                            üìß Send to Intake
                                        </button>
                                        <a
                                            href="https://app.vinesign.com/Jobs/Create"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium text-center transition"
                                        >
                                            ‚úçÔ∏è Send Contract
                                        </a>
                                        <a
                                            href="https://thepatelfirm.filevineapp.com/#/project/create"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium text-center transition"
                                        >
                                            üìÅ Create Project
                                        </a>
                                    </div>

                                    {/* Client Details */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Identification</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">Name:</span> 
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.clientName || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, clientName: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.clientName || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">DOB:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="date" 
                                                            value={editedClient.dob || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, dob: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.dob || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">SSN:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.ssn || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, ssn: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.ssn || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Health Insurance:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.healthInsurance || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, healthInsurance: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.healthInsurance || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">DL #:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.dlNumber || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, dlNumber: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.dlNumber || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Seat Position:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.seatPosition || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, seatPosition: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.seatPosition || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Contact</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">Phone:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="tel" 
                                                            value={editedClient.phone || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, phone: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.phone || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Email:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="email" 
                                                            value={editedClient.email || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, email: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.email || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Mailing Address:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.mailingAddress || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, mailingAddress: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.mailingAddress || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Emergency Contact:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.emergencyContact || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, emergencyContact: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.emergencyContact || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Incident Facts</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">DOI:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="date" 
                                                            value={editedClient.doi || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, doi: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.doi || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Incident Type:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.incidentType || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, incidentType: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.incidentType || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Accident Type:</span>
                                                    {isEditingClient ? (
                                                        <select 
                                                            value={editedClient.accidentType || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, accidentType: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        >
                                                            <option value="">Select type</option>
                                                            <option value="Head-on">Head-on</option>
                                                            <option value="T-bone">T-bone</option>
                                                            <option value="Side swipe">Side swipe</option>
                                                            <option value="Rear-end">Rear-end</option>
                                                            <option value="Hit/Run">Hit/Run</option>
                                                            <option value="Pedestrian">Pedestrian</option>
                                                        </select>
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.accidentType || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Location:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.cityCountyState || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, cityCountyState: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.cityCountyState || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Details:</span>
                                                    {isEditingClient ? (
                                                        <textarea 
                                                            value={editedClient.accidentDetails || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, accidentDetails: e.target.value})}
                                                            rows="3"
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.accidentDetails || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Police Report:</span>
                                                    {isEditingClient ? (
                                                        <select 
                                                            value={editedClient.policeReport || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, policeReport: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        >
                                                            <option value="">Select</option>
                                                            <option value="Yes">Yes</option>
                                                            <option value="No">No</option>
                                                        </select>
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.policeReport || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Police Dept:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.policeReportDept || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, policeReportDept: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.policeReportDept || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Report #:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.policeReportNumber || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, policeReportNumber: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.policeReportNumber || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Medical</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">Injuries:</span>
                                                    {isEditingClient ? (
                                                        <textarea 
                                                            value={editedClient.injuries || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, injuries: e.target.value})}
                                                            rows="2"
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.injuries || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Hospital/EMS:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.hospitalEMS || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, hospitalEMS: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.hospitalEMS || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Adverse Party Insurance</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">Name:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.adverseName || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, adverseName: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.adverseName || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">DL Number:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.adverseDL || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, adverseDL: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.adverseDL || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">License Plates:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.adversePlates || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, adversePlates: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.adversePlates || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Auto Insurance:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.adverseAutoIns || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, adverseAutoIns: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.adverseAutoIns || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Claim #:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.adverseClaimNumber || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, adverseClaimNumber: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.adverseClaimNumber || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Client Insurance</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">Insurance Company:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.clientInsCompany || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, clientInsCompany: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.clientInsCompany || 'N/A'}</span>
                                                    )}
                                                </div>
                                                <div>
                                                    <span className="font-medium">Policy #:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.clientPolicyNumber || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, clientPolicyNumber: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.clientPolicyNumber || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                            
                                            <h3 className="text-lg font-semibold mb-3 mt-4 text-gray-900 border-b pb-2">Vehicle</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="font-medium">Vehicle:</span>
                                                    {isEditingClient ? (
                                                        <input 
                                                            type="text" 
                                                            value={editedClient.clientVehicle || ''} 
                                                            onChange={(e) => setEditedClient({...editedClient, clientVehicle: e.target.value})}
                                                            className="ml-2 px-2 py-1 border rounded w-full mt-1"
                                                        />
                                                    ) : (
                                                        <span className="ml-2">{selectedClient.clientVehicle || 'N/A'}</span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Case Management */}
                                    <div>
                                        <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">Case Management</h3>
                                        {isEditingClient ? (
                                            <input 
                                                type="url" 
                                                value={editedClient.caseManagementLink || ''} 
                                                onChange={(e) => setEditedClient({...editedClient, caseManagementLink: e.target.value})}
                                                placeholder="https://..."
                                                className="px-2 py-1 border rounded w-full"
                                            />
                                        ) : (
                                            selectedClient.caseManagementLink ? (
                                                <a href={selectedClient.caseManagementLink} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                                                    {selectedClient.caseManagementLink}
                                                </a>
                                            ) : (
                                                <span className="text-gray-500">N/A</span>
                                            )
                                        )}
                                    </div>

                                    {/* History */}
                                    <div>
                                        <h3 className="text-lg font-semibold mb-3 text-gray-900 border-b pb-2">History</h3>
                                        <div className="space-y-2">
                                            {selectedClient.history && selectedClient.history.map((entry, idx) => (
                                                <div key={idx} className="bg-gray-50 p-3 rounded-lg text-sm">
                                                    <div className="font-medium text-gray-900">{entry.action}</div>
                                                    <div className="text-gray-600">{entry.user} ‚Ä¢ {new Date(entry.timestamp).toLocaleString()}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Tracking Info */}
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h3 className="text-lg font-semibold mb-2 text-gray-900">Tracking Information</h3>
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div><span className="font-medium">Added By:</span> {selectedClient.addedBy || 'N/A'}</div>
                                            <div><span className="font-medium">Intake Date:</span> {selectedClient.intakeDate ? new Date(selectedClient.intakeDate).toLocaleString() : 'N/A'}</div>
                                            {selectedClient.lastUpdatedBy && (
                                                <>
                                                    <div><span className="font-medium">Last Updated By:</span> {selectedClient.lastUpdatedBy}</div>
                                                    <div><span className="font-medium">Last Updated:</span> {selectedClient.lastUpdated ? new Date(selectedClient.lastUpdated).toLocaleString() : 'N/A'}</div>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<PNCManager />, document.getElementById('root'));
    </script>
</body>
</html>
